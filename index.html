<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://chiwenchen.github.io/">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">

  <!-- http://opengraphprotocol.org/ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://chiwenchen.github.io/">
  <meta property="og:title" content="My Octopress Blog">
  

  <script src="/javascripts/libs/jquery/jquery-2.1.3.min.js"></script>

<link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">


  
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">

  

</head>

  <body   >
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" title="toggle navbar" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">My Octopress Blog</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a rel="index" href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="navbar-form navbar-right" action="https://www.google.com/search" method="GET">
                    <input type="hidden" name="sitesearch" value="chiwenchen.github.io">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" role="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <div class="blog-index" itemscope itemtype="http://schema.org/Blog">
    <meta itemprop="name" content="My Octopress Blog" />
    
    <meta itemprop="url" content="http://chiwenchen.github.io" />
      
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2017-03-21T15:55:13+08:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2017/03/21/deploy-docker-on-aws-ecs/" itemprop="url">Deploy Docker on AWS ECS</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><h2>Install AWS CLI</h2>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>curl "https://s3.amazonaws.com/aws-cli/awscli-bundle.zip" -o "awscli-bundle.zip"
</span><span class='line'>unzip awscli-bundle.zip
</span><span class='line'>sudo ./awscli-bundle/install -i /usr/local/aws -b /usr/local/bin/aws
</span><span class='line'>rm -rf awscli-bundle.zip awscli-bundle
</span><span class='line'>aws --version
</span><span class='line'>aws configure
</span><span class='line'>$ AWS Access Key ID [None]: AKIAJFDFWOHD6SQEWQ
</span><span class='line'>$ AWS Secret Access Key [None]: JSgxIzkN8tC6vqfsXDGwC3Z+mJdH0ROF
</span><span class='line'>$ Default region name [None]: us-east-1
</span><span class='line'>$ Default output format [None]:</span></code></pre></td></tr></table></div></figure>


<h2>Create SSH keypair</h2>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>aws ec2 create-key-pair --key-name aws-chiwen --query 'KeyMaterial' --output text &gt; ~/.ssh/aws-chiwen.pem
</span><span class='line'>chmod 400 ~/.ssh/aws-chiwen.pem
</span><span class='line'>aws ec2 describe-key-pairs --key-name aws-chiwen</span></code></pre></td></tr></table></div></figure>


<h2>Configure Security Group</h2>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># create security group
</span><span class='line'>aws ec2 create-security-group --group-name chiwen_SG_useast1 --description "Security group for chiwen on us-east-1"
</span><span class='line'>aws ec2 authorize-security-group-ingress --group-id sg-f61db289 --protocol tcp --port 22 --cidr 0.0.0.0/0
</span><span class='line'>aws ec2 authorize-security-group-ingress --group-id sg-f61db289 --protocol tcp --port 80 --cidr 0.0.0.0/0
</span><span class='line'># open port for Postgres
</span><span class='line'>aws ec2 authorize-security-group-ingress --group-id sg-f61db289 --protocol tcp --port 5432 --cidr 0.0.0.0/0 --source-group sg-f61db289
</span><span class='line'># open port for redis
</span><span class='line'>aws ec2 authorize-security-group-ingress --group-id sg-f61db289 --protocol tcp --port 6379 --cidr 0.0.0.0/0 --source-group sg-f61db289
</span><span class='line'># show security group config
</span><span class='line'>aws ec2 describe-security-groups --group-id sg-f61db289</span></code></pre></td></tr></table></div></figure>




<h2>Create ECS cluster</h2>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>aws ecs create-cluster --cluster-name deepdive # create a cluster
</span><span class='line'>aws ecs list-clusters # list all clusters
</span><span class='line'>aws ecs describe-clusters --clusters deepdive # show detail for a cluster</span></code></pre></td></tr></table></div></figure>




<h2>Container Agent</h2>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>aws s3api create-bucket --bucket chiwen_deepdive
</span><span class='line'>cd deepdive
</span><span class='line'>aws s3 cp ecs.config s3://chiwen_deepdive/ecs.config
</span><span class='line'>aws s3 ls s3://chiwen_deepdive</span></code></pre></td></tr></table></div></figure>

</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2017-03-21T15:47:06+08:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2017/03/21/steps-for-deploy-from-different-machine/" itemprop="url">Steps for Deploy From Different Machine</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>If you want to deploy your Octopress from multipal machines, here is the post you can reference to configure your new machine to match the needs.</p>

<p><a href="http://rajpushkar.github.io/blog/2013/09/27/how-to-operate-octopress-blog-from-multiple-places/">http://rajpushkar.github.io/blog/2013/09/27/how-to-operate-octopress-blog-from-multiple-places/</a></p>

<p>before you deploy new commit from a new machine, you have to make sure the octopress folder is in sync, here is the steps to do so.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd to/your/octopress/folder
</span><span class='line'>$ git pull origin source
</span><span class='line'>$ cd _deploy
</span><span class='line'>$ git pull origin master
</span><span class='line'>
</span><span class='line'>###### now you can create new post and commit...
</span><span class='line'>$ rake new_post
</span><span class='line'>... and so on</span></code></pre></td></tr></table></div></figure>

</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2016-12-12T15:16:31+08:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2016/12/12/put-img-inmiddle-of-hr-tag/" itemprop="url">Put Img in Middle of Hr Tag</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>This is one way to put image in the middle of hr</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='haml'><span class='line'><span class="nt">%hr</span><span class="nc">.half</span>
</span><span class='line'><span class="nc">.step-img</span><span class="p">=</span> <span class="n">image_tag</span> <span class="s2">&quot;step-3.png&quot;</span>
</span><span class='line'><span class="nt">%hr</span><span class="nc">.half</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nc">.half</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span> <span class="m">45%</span><span class="p">;</span>
</span><span class='line'>  <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nc">.step-img</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span> <span class="m">9%</span><span class="p">;</span>
</span><span class='line'>  <span class="n">img</span> <span class="err">{</span>
</span><span class='line'>    <span class="k">display</span><span class="o">:</span> <span class="k">block</span><span class="p">;</span>
</span><span class='line'>    <span class="k">margin</span><span class="o">:</span> <span class="m">0</span> <span class="k">auto</span><span class="p">;</span>
</span><span class='line'>    <span class="k">margin-top</span><span class="o">:</span> <span class="m">-24px</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="err">}</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2016-09-27T11:20:27+08:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2016/09/27/install-ubuntu-nginx-postgresql-and-passenger-in-aws/" itemprop="url">Install Ubuntu, Nginx, Postgresql and Passenger in AWS</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><h4>Create User</h4>


<p>step1: create user</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo adduser apps
</span><span class='line'>Enter new UNIX password: apps
</span><span class='line'>Retype new UNIX password: apps
</span><span class='line'>passwd: password updated successfully
</span><span class='line'>Changing the user information for apps
</span><span class='line'>Enter the new value, or press ENTER for the default
</span><span class='line'>        Full Name []:
</span><span class='line'>        Room Number []:
</span><span class='line'>        Work Phone []:
</span><span class='line'>        Home Phone []:
</span><span class='line'>        Other []:
</span><span class='line'>Is the information correct? [Y/n] Y</span></code></pre></td></tr></table></div></figure>


<p>step2: give user the sudo authrization</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo visudo
</span><span class='line'># add [apps ALL=(ALL:ALL) ALL] in the file.</span></code></pre></td></tr></table></div></figure>


<p>step3: switch to apps</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>su apps</span></code></pre></td></tr></table></div></figure>


<p>step4: update server</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get update
</span><span class='line'>$ sudo apt-get upgrade</span></code></pre></td></tr></table></div></figure>


<p>step5: setup SSH</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ssh-keygen
</span><span class='line'>$ cd ~/.ssh
</span><span class='line'>$ touch authorized_keys
</span><span class='line'>$ vi authorized_keys
</span><span class='line'>copy and past local machine's public key here</span></code></pre></td></tr></table></div></figure>


<p>step6: make ssh more easy</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># in local machine
</span><span class='line'>$ vi ~/.ssh/config
</span><span class='line'>
</span><span class='line'>#add below line, mgstg can be any command you want.
</span><span class='line'>Host myapp-staging
</span><span class='line'>  HostName IPorDomainName
</span><span class='line'>  User apps</span></code></pre></td></tr></table></div></figure>


<p>step7: setting time zone and NTP server</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo dpkg-reconfigure tzdata
</span><span class='line'>$ sudo apt-get install ntp
</span><span class='line'>$ sudo ntpdate ntp.ubuntu.com # Update time</span></code></pre></td></tr></table></div></figure>


<p>step8: configure hostname</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo hostname your-hostname
</span><span class='line'>$ sudo vim /etc/hosts
</span><span class='line'>###
</span><span class='line'>127.0.0.1 your-hostname
</span><span class='line'>###
</span><span class='line'>$ sudo vim /etc/hostname
</span><span class='line'>###
</span><span class='line'>your-hostname
</span><span class='line'>###
</span><span class='line'>$hostname #verify the hostname is set</span></code></pre></td></tr></table></div></figure>


<p>step9: install dependencies for ruby(source from GoRails)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install git-core curl zlib1g-dev build-essential libssl-dev libreadline-dev libyaml-dev libsqlite3-dev sqlite3 libxml2-dev libxslt1-dev libcurl4-openssl-dev python-software-properties libffi-dev</span></code></pre></td></tr></table></div></figure>


<p>step10: install RVM and ruby</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install libgdbm-dev libncurses5-dev automake libtool bison libffi-dev
</span><span class='line'>gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3
</span><span class='line'>curl -sSL https://get.rvm.io | bash -s stable
</span><span class='line'>source ~/.rvm/scripts/rvm
</span><span class='line'>rvm install 2.2.5
</span><span class='line'>rvm use 2.2.5 --default
</span><span class='line'>ruby -v</span></code></pre></td></tr></table></div></figure>


<p>step11: config Git</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git config --global color.ui true
</span><span class='line'>$ git config --global user.name "YOUR NAME"
</span><span class='line'>$ git config --global user.email "YOUR@EMAIL.com"
</span><span class='line'>$ ssh-keygen -t rsa -b 4096 -C "YOUR@EMAIL.com"
</span><span class='line'>$ cat ~/.ssh/id_rsa.pub
</span><span class='line'># paste the ssh key in https://github.com/settings/ssh
</span><span class='line'>$ ssh -T git@github.com check if the ssh worked.
</span><span class='line'># you should see something like this:
</span><span class='line'>  # Hi chiwen! You've successfully authenticated, but GitHub does not provide shell access.</span></code></pre></td></tr></table></div></figure>


<p>step12: install Rails
Since Rails ships with so many dependencies these days, we&rsquo;re going to need to install a Javascript runtime like NodeJS. This lets you use Coffeescript and the Asset Pipeline in Rails which combines and minifies your javascript to provide a faster production environment.</p>

<p>To install NodeJS, we&rsquo;re going to add it using the official repository:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ curl -sL https://deb.nodesource.com/setup_4.x | sudo -E bash -
</span><span class='line'>$ sudo apt-get install -y nodejs
</span><span class='line'>$ gem install rails -v 4.2.6
</span><span class='line'>$ rails -v</span></code></pre></td></tr></table></div></figure>


<p>step13: install Postgresql</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo sh -c "echo 'deb http://apt.postgresql.org/pub/repos/apt/ precise-pgdg main' &gt; /etc/apt/sources.list.d/pgdg.list"
</span><span class='line'>$ wget --quiet -O - http://apt.postgresql.org/pub/repos/apt/ACCC4CF8.asc | sudo apt-key add -
</span><span class='line'>$ sudo apt-get update
</span><span class='line'>$ sudo apt-get install postgresql-common
</span><span class='line'>$ sudo apt-get install postgresql-9.5 libpq-dev</span></code></pre></td></tr></table></div></figure>


<p>step14: create pssql user</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#replace the `apps` to the username you want
</span><span class='line'>$ sudo -u postgres createuser apps -s
</span><span class='line'>
</span><span class='line'># If you would like to set a password for the user, you can do the following
</span><span class='line'>$ sudo -u postgres psql
</span><span class='line'>$ postgres=# \password chris</span></code></pre></td></tr></table></div></figure>


<p>step15: install passenger and nginx(source from <a href="https://www.phusionpassenger.com/library/walkthroughs/deploy/ruby/ownserver/nginx/oss/trusty/install_passenger.html">https://www.phusionpassenger.com/library/walkthroughs/deploy/ruby/ownserver/nginx/oss/trusty/install_passenger.html</a>)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 561F9B9CAC40B2F7
</span><span class='line'>$ sudo apt-get install -y apt-transport-https ca-certificates
</span><span class='line'>
</span><span class='line'># Add our APT repository
</span><span class='line'>$ sudo sh -c 'echo deb https://oss-binaries.phusionpassenger.com/apt/passenger trusty main &gt; /etc/apt/sources.list.d/passenger.list'
</span><span class='line'>$ sudo apt-get update
</span><span class='line'>
</span><span class='line'># Install Passenger + Nginx
</span><span class='line'>$ sudo apt-get install -y nginx-extras passenger</span></code></pre></td></tr></table></div></figure>


<p>step16: configuration passenger</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo vim /etc/nginx/nginx.conf
</span><span class='line'># uncomment below line.
</span><span class='line'># include /etc/nginx/passenger.conf;
</span><span class='line'>
</span><span class='line'># restart the server
</span><span class='line'>$ sudo service nginx restart</span></code></pre></td></tr></table></div></figure>


<p>step17: check installation</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo /usr/bin/passenger-config validate-install
</span><span class='line'># you should see all passed like below
</span><span class='line'>  * Checking whether this Passenger install is in PATH... ✓
</span><span class='line'>  * Checking whether there are no other Passenger installations... ✓
</span><span class='line'>$ sudo /usr/sbin/passenger-memory-stats
</span><span class='line'># you should see nginx and passenger is having some process running.</span></code></pre></td></tr></table></div></figure>


<p>step18: deploying using capistrano</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>local$ cap staging deploy:check
</span><span class='line'># create database.yml under /home/apps/myguide/shared/config and paste the local setting to here.
</span><span class='line'>#run again
</span><span class='line'>local$ cap staging deploy:check
</span><span class='line'>$ $ createdb myguide-staging
</span><span class='line'>local$ cap staging deploy</span></code></pre></td></tr></table></div></figure>


<p>step19: change root in nginx.conf</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vi /etc/nginx/nginx.conf
</span></code></pre></td></tr></table></div></figure>


<p>Trouble shooting:
From the commandline you can run <code>nginx -c /etc/nginx/nginx.conf -t</code> to have nginx check your configuration for errors.</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2016-07-23T09:31:56+08:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2016/07/23/aws-training-essential/" itemprop="url">AWS Training Essential</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>Region &lt; AZ(Cluster of Data Center) &lt; Data Center</p>

<p>DR(災難備援)</p>

<p>53 is DNS Port</p>

<p>EC2 is a compute node, charge rate is hourly based.</p>

<p>Globe level:
Edge location:
  Route 53
  CloudFront
Region:
  AMI
  S3
AZ:
  EC2 EBS</p>

<p>EBS is the persistance storage of EC2, connect thru network, EC2 instance store is in the same rake of EC2. EBS is more recommandated. AMI will describe it&rsquo;s root device is EBS or instance storage.</p>

<p>can instance store backup.</p>

<p>reboot: same EC2 instance remain.
stop/start: will reassign a new EC2 instance.</p>

<p>Security:
  user based policy: IAM, who can do what in which resources(high recommandated, easier to manage)
  resource baseb policy: who can do what
  when two policy conflict, use the most restricted one.
  Enable MFA for privilige user</p>

<p>RDS is powered by EC2 and EBS behind in sceen
Auto scaling is Horizontal scaling, add or reduce number of instance</p>

<p>self pace learning</p>

<p>run.qwiklab.com</p>

<p><a href="https://742710798012.signin.aws.amazon.com/console">https://742710798012.signin.aws.amazon.com/console</a></p>

<p>VPC Endpoint 可以讓VPC中的node可以不用透過public network 去連接 S3.</p>

<p>Security Group v.s. Network ACLs</p>

<p>traffic path:
instance &lt; security group &lt; network ACLs &lt; route table &lt; public IP or igw</p>

<p>NAT Gatwway(managed service) instead of NAT Server(actually a EC2 instance)</p>

<p>A record vs CNAME vs ALIAS
A record: map to IP address
ALIAS: map to DNS name</p>

<p>availibility -> 通常指系統
durability -> 通常指data</p>

<p>data at transit -> thru HTTPS to secure data when data transition
data at rest -> encrype when store data</p>

<p>IAM user:
  credential:
    username and password
    access key / security key
  can be a real user or a service (e.g. EC2)</p>

<p>IAM role:
  trusted entity: 誰可以用這個role: AWS resource, AWS account, faderation user(authentication outside AWS, but get authorization thru STS)
  policy:</p>

<p>Bastion Host:
  從外面連到web tier的跳板</p>

<p>cloudwatch logs:
  logs -> metrics filter -> metrics -> alarm -> email</p>

<p>Make Bastion always availiable: set ELB min:1 max:1 desired:1</p>

<p>managed service will more cost efficient than self managed service</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2016-04-30T09:30:34+08:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2016/04/30/d3-dot-js/" itemprop="url">D3.js</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>活動下一場是機器學習</p>

<p>illustrator 畫圖後存成svg</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2016-03-17T19:15:27+08:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2016/03/17/neo4j-and-graph-database/" itemprop="url">Neo4j and Graph Database</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>Keywords &amp; notes in the speech:</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2016-03-15T12:18:24+08:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2016/03/15/deploy-rails-to-ubuntu/" itemprop="url">Deploy_rails_to_ubuntu</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>when first time you access the ubuntu server by using the command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ssh root@139.162.33.247
</span><span class='line'>#this is mine, use you own, you can find the ip in Linode Manager -&gt; Remote Access -&gt; SSH Access</span></code></pre></td></tr></table></div></figure>


<p>a ssh key will actomatically created in ~/.ssh/known_hosts, looks like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>139.162.33.247 ssh-rsa AAA.....(bunch of alphabet).........Rn</span></code></pre></td></tr></table></div></figure>



</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2016-03-06T12:24:41+08:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2016/03/06/update-new-version-in-heroku/" itemprop="url">Update New Version in Heroku</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>if we have two different server in heroku like this</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>➜  myflix git:(staging) git remote -v
</span><span class='line'>origin  https://github.com/chiwenchen/myflix.git (fetch)
</span><span class='line'>origin  https://github.com/chiwenchen/myflix.git (push)
</span><span class='line'>production  https://git.heroku.com/chiwen-myflix.git (fetch)
</span><span class='line'>production  https://git.heroku.com/chiwen-myflix.git (push)
</span><span class='line'>staging https://git.heroku.com/chiwen-myflix-staging.git (fetch)
</span><span class='line'>staging https://git.heroku.com/chiwen-myflix-staging.git (push)</span></code></pre></td></tr></table></div></figure>


<p>here is the whole process if we want to push a new version to staging server</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>➜  myflix git:(SOMEOTHER BRANCH) git branch staging # navigate to staging branch
</span><span class='line'>
</span><span class='line'>➜  myflix git:(staging) git add .
</span><span class='line'>➜  myflix git:(staging) git commit -m 'new stable version'
</span><span class='line'>➜  myflix git:(staging) git push
</span><span class='line'>...
</span><span class='line'>➜  myflix git:(staging) git push staging staging:master
</span><span class='line'>...
</span><span class='line'>➜  myflix git:(staging) heroku run rake db:migrate
</span><span class='line'>...
</span><span class='line'>➜  myflix git:(staging) heroku restart
</span><span class='line'>...
</span><span class='line'>Done!!</span></code></pre></td></tr></table></div></figure>


<p>let&rsquo;s make another example to clarify the command full of <code>staging</code>&hellip;</p>

<p>if we have a remote repo named: <code>live-remote</code>, and a local repo named: <code>live</code></p>

<p>then the last command will be:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>➜  myflix git:(staging) git push live-remote live:master</span></code></pre></td></tr></table></div></figure>


<p>the additional :master here is saying push my local <code>live</code> branch into the master branch on the remote - note: heroku can only deploy from the master branch.</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2016-02-24T16:32:45+08:00"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2016/02/24/decorator-for-model/" itemprop="url">Decorator</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>For the typical situation, all the logic should only live in model layer, and controller only responsible on grap the data we need and show it in view.</p>

<p>But in some situation, we will still need logic code in view layer. we can certainly do this, but this will make the view template too complicate than it should be and harder to read. so in this type of situation, we can use <code>decorator</code> to extract logic code from view template.</p>

</div>
  
  
    <footer>
      <a class="read-more btn btn-default" href="/blog/2016/02/24/decorator-for-model/">Read on &rarr;</a>
    </footer>
  


        </article>
      
    </div>

    <ul class="pager">
      
        <li class="previous"><a href="/posts/2">&larr;&nbsp;Older</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
        <li class="next disabled"><a href="#">Newer&nbsp;&rarr;</a></li>
      
    </ul>
  </div>

  
    <aside class="sidebar col-md-3">
      
        <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/blog/2017/03/21/deploy-docker-on-aws-ecs/">Deploy Docker on AWS ECS</a>
    
    <a class="list-group-item " href="/blog/2017/03/21/steps-for-deploy-from-different-machine/">Steps for Deploy From Different Machine</a>
    
    <a class="list-group-item " href="/blog/2016/12/12/put-img-inmiddle-of-hr-tag/">Put Img in Middle of Hr Tag</a>
    
    <a class="list-group-item " href="/blog/2016/09/27/install-ubuntu-nginx-postgresql-and-passenger-in-aws/">Install Ubuntu, Nginx, Postgresql and Passenger in AWS</a>
    
    <a class="list-group-item " href="/blog/2016/07/23/aws-training-essential/">AWS Training Essential</a>
    
  </div>
</section>






      
    </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2017 - Your Name<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr.js"></script>


  </body>
</html>
